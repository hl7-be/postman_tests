{
	"info": {
		"_postman_id": "58d4c6eb-803c-4287-a9c6-087c4efbb734",
		"name": "Automated_tests",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Adding same allergy should not be allowed",
			"item": [
				{
					"name": "Search allergy by patient SSIN",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"const responseJson = pm.response.json();\r",
									"if (responseJson.total===(0)) {\r",
									"postman.setNextRequest(\"Create new allergy\")\r",
									"} else {\r",
									"pm.environment.set(\"allergy_id\", responseJson.entry[0].resource.id);\r",
									"postman.setNextRequest(\"Delete allergy\");\r",
									"}\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{host}}/AllergyIntolerance?patient.identifier=https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}",
							"host": [
								"{{host}}"
							],
							"path": [
								"AllergyIntolerance"
							],
							"query": [
								{
									"key": "patient.identifier",
									"value": "https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete allergy",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{host}}/AllergyIntolerance/{{allergy_id}}",
							"host": [
								"{{host}}"
							],
							"path": [
								"AllergyIntolerance",
								"{{allergy_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "See if any allergy remains; if so, repeat Delete",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"const responseJson = pm.response.json();\r",
									"if (responseJson.total===(0)) {\r",
									"postman.setNextRequest(\"Create new allergy\")\r",
									"} else {\r",
									"pm.environment.set(\"allergy_id\", responseJson.entry[0].resource.id);\r",
									"postman.setNextRequest(\"Delete allergy\");\r",
									"}\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{host}}/AllergyIntolerance?patient.identifier=https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}",
							"host": [
								"{{host}}"
							],
							"path": [
								"AllergyIntolerance"
							],
							"query": [
								{
									"key": "patient.identifier",
									"value": "https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Create new allergy",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = JSON.parse(responseBody);\r",
									"\r",
									"if (jsonData.id !== null) { //pm.response.code == 201\r",
									"    pm.environment.set('allergy_id', jsonData.id);\r",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Accept",
								"type": "text",
								"value": "application/fhir+json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"resourceType\" : \"AllergyIntolerance\",\r\n  \"meta\" : {\r\n    \"profile\" : [\r\n      \"https://www.ehealth.fgov.be/standards/fhir/StructureDefinition/be-allergyintolerance\"\r\n    ]\r\n  },\r\n  \"clinicalStatus\" : {\r\n    \"coding\" : [\r\n      {\r\n        \"system\" : \"http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical\",\r\n        \"code\" : \"active\",\r\n        \"display\" : \"Active\"\r\n      }\r\n    ]\r\n  },\r\n  \"verificationStatus\" : {\r\n    \"coding\" : [\r\n      {\r\n        \"system\" : \"http://terminology.hl7.org/CodeSystem/allergyintolerance-verification\",\r\n        \"code\" : \"unconfirmed\"\r\n      }\r\n    ]\r\n  },\r\n  \"type\" : \"allergy\",\r\n  \"category\" : [\r\n    \"food\"\r\n  ],\r\n  \"code\" : {\r\n    \"coding\" : [\r\n      {\r\n        \"system\" : \"http://snomed.info/sct\",\r\n        \"code\" : \"735215001\",\r\n        \"display\" : \"Apple (substance)\"\r\n      }\r\n    ],\r\n    \"text\" : \"Allergic to apples - Test 4.6\"\r\n  },\r\n  \"patient\" : {\r\n    \"reference\" : \"Patient?identifier=https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}\"\r\n  },\r\n  \"recordedDate\" : \"2014-10-09T14:58:00+11:00\",\r\n  \"recorder\" : {\r\n    \"reference\" : \"Practitioner?identifier=https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin2}}\"\r\n  },\r\n  \"asserter\" : {\r\n    \"reference\" : \"Patient?identifier=https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}\"\r\n  },\r\n  \"reaction\" : [\r\n    {\r\n      \"manifestation\" : [\r\n        {\r\n          \"coding\" : [\r\n            {\r\n              \"system\" : \"http://snomed.info/sct\",\r\n              \"code\" : \"39579001\",\r\n              \"display\" : \"Anaphylactic reaction\"\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    }\r\n  ]\r\n}"
						},
						"url": {
							"raw": "{{host}}/AllergyIntolerance",
							"host": [
								"{{host}}"
							],
							"path": [
								"AllergyIntolerance"
							]
						}
					},
					"response": []
				},
				{
					"name": "See if allergy created",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Search AllergyIntolerance -- simple\", function(){\r",
									"    pm.expect(pm.response.code).to.equal(200, \"Response status is not 200\");\r",
									"    const responseJson = pm.response.json();\r",
									"    pm.expect(responseJson.resourceType).to.equal(\"Bundle\", \"Response should be a Bundle resource\");\r",
									"    pm.expect(responseJson.total).to.equal(1, \"Response should contain 1 resource\");\r",
									"    pm.expect(responseJson.entry[0].resource.resourceType).to.equal(\"AllergyIntolerance\", \"1st entry in Response should be an Allergy\");\r",
									"\r",
									"});\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Accept",
								"type": "text",
								"value": "application/fhir+json"
							}
						],
						"url": {
							"raw": "{{host}}/AllergyIntolerance?patient.identifier=https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}",
							"host": [
								"{{host}}"
							],
							"path": [
								"AllergyIntolerance"
							],
							"query": [
								{
									"key": "patient.identifier",
									"value": "https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Add same allergy",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = JSON.parse(responseBody);\r",
									"\r",
									"if (jsonData.id !== null) { //pm.response.code == 201\r",
									"    pm.environment.set('allergy_id', jsonData.id);\r",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Accept",
								"type": "text",
								"value": "application/fhir+json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"resourceType\" : \"AllergyIntolerance\",\r\n  \"meta\" : {\r\n    \"profile\" : [\r\n      \"https://www.ehealth.fgov.be/standards/fhir/StructureDefinition/be-allergyintolerance\"\r\n    ]\r\n  },\r\n  \"clinicalStatus\" : {\r\n    \"coding\" : [\r\n      {\r\n        \"system\" : \"http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical\",\r\n        \"code\" : \"active\",\r\n        \"display\" : \"Active\"\r\n      }\r\n    ]\r\n  },\r\n  \"verificationStatus\" : {\r\n    \"coding\" : [\r\n      {\r\n        \"system\" : \"http://terminology.hl7.org/CodeSystem/allergyintolerance-verification\",\r\n        \"code\" : \"unconfirmed\"\r\n      }\r\n    ]\r\n  },\r\n  \"type\" : \"allergy\",\r\n  \"category\" : [\r\n    \"food\"\r\n  ],\r\n  \"code\" : {\r\n    \"coding\" : [\r\n      {\r\n        \"system\" : \"http://snomed.info/sct\",\r\n        \"code\" : \"735215001\",\r\n        \"display\" : \"Apple (substance)\"\r\n      }\r\n    ],\r\n    \"text\" : \"Allergic to apples - Test 4.6\"\r\n  },\r\n  \"patient\" : {\r\n    \"reference\" : \"Patient?identifier=https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}\"\r\n  },\r\n  \"recordedDate\" : \"2014-10-09T14:58:00+11:00\",\r\n  \"recorder\" : {\r\n    \"reference\" : \"Practitioner?identifier=https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin2}}\"\r\n  },\r\n  \"asserter\" : {\r\n    \"reference\" : \"Patient?identifier=https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}\"\r\n  },\r\n  \"reaction\" : [\r\n    {\r\n      \"manifestation\" : [\r\n        {\r\n          \"coding\" : [\r\n            {\r\n              \"system\" : \"http://snomed.info/sct\",\r\n              \"code\" : \"39579001\",\r\n              \"display\" : \"Anaphylactic reaction\"\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    }\r\n  ]\r\n}"
						},
						"url": {
							"raw": "{{host}}/AllergyIntolerance",
							"host": [
								"{{host}}"
							],
							"path": [
								"AllergyIntolerance"
							]
						}
					},
					"response": []
				},
				{
					"name": "Update last allergy",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"PUT BeAllergyIntolerance -- simple\", function(){\r",
									"    pm.expect(pm.response.code).to.equal(200, \"Response status is not 200\");\r",
									"    const responseJson = pm.response.json();\r",
									"    pm.expect(responseJson.resourceType).to.equal(\"AllergyIntolerance\");\r",
									"    pm.expect(responseJson.meta.versionId).to.equal(\"2\");\r",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disabledSystemHeaders": {
							"accept": true
						}
					},
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Accept",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Cache-Control",
								"type": "text",
								"value": "no-cache"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"resourceType\" : \"AllergyIntolerance\",\r\n  \"id\": \"{{allergy_id}}\",\r\n  \"meta\" : {\r\n    \"profile\" : [\r\n      \"https://www.ehealth.fgov.be/standards/fhir/StructureDefinition/be-allergyintolerance\"\r\n    ]\r\n  },\r\n  \"text\" : {\r\n    \"status\" : \"generated\",\r\n    \"div\" : \"<div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"><p><b>Generated Narrative</b></p><h3>Ids</h3><table class=\\\"grid\\\"><tr><td>-</td></tr><tr><td>*</td></tr></table><h3>Meta</h3><table class=\\\"grid\\\"><tr><td>-</td></tr><tr><td>*</td></tr></table><p><b>clinicalStatus</b>: <span title=\\\"Codes: {http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical active}\\\">Active</span></p><p><b>verificationStatus</b>: <span title=\\\"Codes: {http://terminology.hl7.org/CodeSystem/allergyintolerance-verification confirmed}\\\">Confirmed</span></p><p><b>type</b>: allergy</p><p><b>category</b>: food</p><p><b>criticality</b>: high</p><p><b>code</b>: <span title=\\\"Codes: {http://snomed.info/sct 278840001}\\\">Allergic to shrimp</span></p><p><b>patient</b>: <a href=\\\"Patient-patient1.html\\\">Generated Summary: Social Beneficiary Identifier: 79121137740 (OFFICIAL), Medical record number: 45XXP0PA-4 (USUAL); active; Josephine Nessa La Paradisio (OFFICIAL); nessa.laparadisio@belgium.be, Phone: +322476792979, Phone: +3226718655, Phone: +322476799; gender: female; birthDate: 1979-12-11; <span title=\\\"Codes: {http://terminology.hl7.org/CodeSystem/v3-MaritalStatus D}, {https://www.ehealth.fgov.be/standards/fhir/CodeSystem/cd-civilstate 41}\\\">Divorced</span></a></p><p><b>onset</b>: 2004</p><p><b>recordedDate</b>: Oct 9, 2014 5:58:00 AM</p><p><b>recorder</b>: <a href=\\\"Practitioner-practitioner1.html\\\">Generated Summary: id: 79121137740 (OFFICIAL), id: 18749704477 (OFFICIAL); Katherine Pulaski (OFFICIAL); katherine.pulaski@enterprisehospital.be, Phone: 022675198, Fax: 022675209; gender: female; birthDate: 1979-12-11</a></p><p><b>asserter</b>: <a href=\\\"Patient-patient1.html\\\">Generated Summary: Social Beneficiary Identifier: 79121137740 (OFFICIAL), Medical record number: 45XXP0PA-4 (USUAL); active; Josephine Nessa La Paradisio (OFFICIAL); nessa.laparadisio@belgium.be, Phone: +322476792979, Phone: +3226718655, Phone: +322476799; gender: female; birthDate: 1979-12-11; <span title=\\\"Codes: {http://terminology.hl7.org/CodeSystem/v3-MaritalStatus D}, {https://www.ehealth.fgov.be/standards/fhir/CodeSystem/cd-civilstate 41}\\\">Divorced</span></a></p><p><b>lastOccurrence</b>: 2012-06</p><p><b>note</b>: Some extra information can be given here.</p><h3>Reactions</h3><table class=\\\"grid\\\"><tr><td>-</td><td><b>Manifestation</b></td><td><b>Onset</b></td><td><b>Severity</b></td></tr><tr><td>*</td><td><span title=\\\"Codes: {http://snomed.info/sct 39579001}\\\">Anaphylactic reaction</span></td><td>2012-06-12</td><td>severe</td></tr></table></div>\"\r\n  },\r\n  \"clinicalStatus\" : {\r\n    \"coding\" : [\r\n      {\r\n        \"system\" : \"http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical\",\r\n        \"code\" : \"active\",\r\n        \"display\" : \"Active\"\r\n      }\r\n    ]\r\n  },\r\n  \"verificationStatus\" : {\r\n    \"coding\" : [\r\n      {\r\n        \"system\" : \"http://terminology.hl7.org/CodeSystem/allergyintolerance-verification\",\r\n        \"code\" : \"confirmed\"\r\n      }\r\n    ]\r\n  },\r\n  \"type\" : \"allergy\",\r\n  \"category\" : [\r\n    \"food\"\r\n  ],\r\n  \"criticality\" : \"low\",\r\n  \"code\" : {\r\n    \"coding\" : [\r\n      {\r\n        \"system\" : \"http://snomed.info/sct\",\r\n        \"code\" : \"278840001\",\r\n        \"display\" : \"Shrimp (substance)\"\r\n      }\r\n    ],\r\n    \"text\" : \"Allergic to shrimp\"\r\n  },\r\n  \"patient\" : {\r\n    \"reference\" : \"Patient?identifier=https://www.ehealth.fgov.be/standards/fhir/NamingSystem/ssin|{{ssin1}}\"\r\n  },\r\n  \"recorder\" : {\r\n    \"reference\" : \"PractitionerRole?identifier=https://www.ehealth.fgov.be/standards/fhir/NamingSystem/ssin|{{ssin2}}\"\r\n  },\r\n  \"onsetDateTime\" : \"2004\",\r\n  \"recordedDate\" : \"2014-10-09T14:58:00+11:00\",\r\n  \"lastOccurrence\" : \"2012-06\",\r\n  \"note\" : [\r\n    {\r\n      \"text\" : \"Some extra information can be given here.\"\r\n    }\r\n  ],\r\n  \"reaction\" : [\r\n    {\r\n      \"manifestation\" : [\r\n        {\r\n          \"coding\" : [\r\n            {\r\n              \"system\" : \"http://snomed.info/sct\",\r\n              \"code\" : \"39579001\",\r\n              \"display\" : \"Anaphylactic reaction\"\r\n            }\r\n          ]\r\n        }\r\n      ],\r\n      \"onset\" : \"2012-06-12\",\r\n      \"severity\" : \"severe\"\r\n    }\r\n  ]\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{host}}/AllergyIntolerance/{{allergy_id}}",
							"host": [
								"{{host}}"
							],
							"path": [
								"AllergyIntolerance",
								"{{allergy_id}}"
							]
						},
						"description": "This PUT operation updates the criticality from high to low of the AllergyIntolerance resource (of the previous POST request)."
					},
					"response": []
				},
				{
					"name": "Get allergies",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Search AllergyIntolerance -- simple\", function(){\r",
									"    pm.expect(pm.response.code).to.equal(200, \"Response status is not 200\");\r",
									"    const responseJson = pm.response.json();\r",
									"    pm.expect(responseJson.resourceType).to.equal(\"Bundle\", \"Response should be a Bundle resource\");\r",
									"    pm.expect(responseJson.total).to.equal(1, \"Response should contain 1 resource\");\r",
									"    pm.expect(responseJson.entry[0].resource.resourceType).to.equal(\"AllergyIntolerance\", \"1st entry in Response should be an Allergy\");\r",
									"\r",
									"});\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Accept",
								"type": "text",
								"value": "application/fhir+json"
							}
						],
						"url": {
							"raw": "{{host}}/AllergyIntolerance?patient.identifier=https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}",
							"host": [
								"{{host}}"
							],
							"path": [
								"AllergyIntolerance"
							],
							"query": [
								{
									"key": "patient.identifier",
									"value": "https%3A%2F%2Fwww.ehealth.fgov.be%2Fstandards%2Ffhir%2FNamingSystem%2Fssin%7C{{ssin1}}"
								}
							]
						}
					},
					"response": []
				}
			]
		}
	]
}